"use strict";(self.webpackChunksemana_9=self.webpackChunksemana_9||[]).push([[775],{53:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"memory/retainer-paths","title":"An\xe1lisis de Rutas de Retenci\xf3n","description":"Las rutas de retenci\xf3n (retainer paths) son cadenas de referencias que mantienen un objeto en memoria, impidiendo que sea recolectado por el garbage collector. Analizar estas rutas es crucial para identificar la causa ra\xedz de las fugas de memoria.","source":"@site/docs/memory/retainer-paths.md","sourceDirName":"memory","slug":"/memory/retainer-paths","permalink":"/memory/retainer-paths","draft":false,"unlisted":false,"editUrl":"https://github.com/HaroldRumiche/semana-9/tree/main/docs/memory/retainer-paths.md","tags":[],"version":"current","lastUpdatedBy":"HaroldRumiche","lastUpdatedAt":1745307533000,"sidebarPosition":5,"frontMatter":{"id":"retainer-paths","title":"An\xe1lisis de Rutas de Retenci\xf3n","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Comparaci\xf3n de Heap Snapshots (Heap Diff)","permalink":"/memory/heap-diff"},"next":{"title":"Instrumentaci\xf3n de Asignaci\xf3n de Memoria","permalink":"/memory/allocation-instrumentation"}}');var a=s(4848),r=s(8453);const t={id:"retainer-paths",title:"An\xe1lisis de Rutas de Retenci\xf3n",sidebar_position:5},l="An\xe1lisis de Rutas de Retenci\xf3n",d={},o=[{value:"Fundamentos de las rutas de retenci\xf3n",id:"fundamentos-de-las-rutas-de-retenci\xf3n",level:2},{value:"Acceso al an\xe1lisis de rutas de retenci\xf3n",id:"acceso-al-an\xe1lisis-de-rutas-de-retenci\xf3n",level:2},{value:"Interpretaci\xf3n de la vista de retainers",id:"interpretaci\xf3n-de-la-vista-de-retainers",level:2},{value:"Panel de retenci\xf3n",id:"panel-de-retenci\xf3n",level:3},{value:"Tipos de nodos en la ruta",id:"tipos-de-nodos-en-la-ruta",level:3},{value:"Patrones comunes de retenci\xf3n problem\xe1tica",id:"patrones-comunes-de-retenci\xf3n-problem\xe1tica",level:2},{value:"Retenci\xf3n desde closures",id:"retenci\xf3n-desde-closures",level:3},{value:"Retenci\xf3n de elementos DOM eliminados",id:"retenci\xf3n-de-elementos-dom-eliminados",level:3},{value:"Retenci\xf3n en event listeners",id:"retenci\xf3n-en-event-listeners",level:3},{value:"An\xe1lisis sistem\xe1tico de rutas de retenci\xf3n",id:"an\xe1lisis-sistem\xe1tico-de-rutas-de-retenci\xf3n",level:2},{value:"M\xe9todo de seguimiento de rutas",id:"m\xe9todo-de-seguimiento-de-rutas",level:3},{value:"An\xe1lisis de dominadores",id:"an\xe1lisis-de-dominadores",level:3},{value:"Casos de estudio comunes",id:"casos-de-estudio-comunes",level:2},{value:"Detectar event listeners persistentes",id:"detectar-event-listeners-persistentes",level:3},{value:"Analizar referencias circulares",id:"analizar-referencias-circulares",level:3},{value:"Identificar caches sin l\xedmites",id:"identificar-caches-sin-l\xedmites",level:3},{value:"Consejos avanzados",id:"consejos-avanzados",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"an\xe1lisis-de-rutas-de-retenci\xf3n",children:"An\xe1lisis de Rutas de Retenci\xf3n"})}),"\n",(0,a.jsx)(n.p,{children:"Las rutas de retenci\xf3n (retainer paths) son cadenas de referencias que mantienen un objeto en memoria, impidiendo que sea recolectado por el garbage collector. Analizar estas rutas es crucial para identificar la causa ra\xedz de las fugas de memoria."}),"\n",(0,a.jsx)(n.h2,{id:"fundamentos-de-las-rutas-de-retenci\xf3n",children:"Fundamentos de las rutas de retenci\xf3n"}),"\n",(0,a.jsx)(n.p,{children:"Para entender las rutas de retenci\xf3n, es importante comprender:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Retainer"}),": Un objeto que mantiene una referencia a otro, impidiendo su liberaci\xf3n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Retaining path"}),": Secuencia de objetos que conectan las GC roots con un objeto espec\xedfico"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"GC roots"}),": Objetos base desde los que el recolector de basura rastrea referencias"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Strong reference"}),": Referencia que impide que un objeto sea liberado"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"acceso-al-an\xe1lisis-de-rutas-de-retenci\xf3n",children:"Acceso al an\xe1lisis de rutas de retenci\xf3n"}),"\n",(0,a.jsx)(n.p,{children:"Para examinar las rutas de retenci\xf3n de un objeto:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Captura un heap snapshot"}),"\n",(0,a.jsx)(n.li,{children:"Localiza el objeto de inter\xe9s (usando filtros o navegaci\xf3n)"}),"\n",(0,a.jsx)(n.li,{children:"Selecciona el objeto haciendo clic en \xe9l"}),"\n",(0,a.jsx)(n.li,{children:'En el panel inferior, selecciona la pesta\xf1a "Retainers"'}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"interpretaci\xf3n-de-la-vista-de-retainers",children:"Interpretaci\xf3n de la vista de retainers"}),"\n",(0,a.jsx)(n.p,{children:"La vista de retainers muestra:"}),"\n",(0,a.jsx)(n.h3,{id:"panel-de-retenci\xf3n",children:"Panel de retenci\xf3n"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Object"}),": El objeto retenedor"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Distance"}),": Distancia desde el objeto seleccionado"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Dominador"}),": Si este objeto es el dominador inmediato"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Path"}),": Descripci\xf3n de la ruta desde el retenedor al objeto"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"tipos-de-nodos-en-la-ruta",children:"Tipos de nodos en la ruta"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"window"}),": El objeto global del navegador"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"document"}),": El documento DOM actual"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"(GC roots)"}),": Puntos de partida para el recolector de basura"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"(closure)"}),": Funciones que capturan variables del entorno"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"(array, string, number, etc.)"}),": Tipos de datos primitivos y estructuras"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"patrones-comunes-de-retenci\xf3n-problem\xe1tica",children:"Patrones comunes de retenci\xf3n problem\xe1tica"}),"\n",(0,a.jsx)(n.p,{children:"Ciertos patrones aparecen frecuentemente en las fugas de memoria:"}),"\n",(0,a.jsx)(n.h3,{id:"retenci\xf3n-desde-closures",children:"Retenci\xf3n desde closures"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function createProblem() {\r\n  const largeData = new Array(1000000).fill('x');\r\n  return function() {\r\n    // Esta closure retiene largeData en memoria\r\n    console.log(largeData.length);\r\n  };\r\n}\r\nconst leak = createProblem();\n"})}),"\n",(0,a.jsx)(n.p,{children:'En el snapshot, ver\xe1s una cadena de retenci\xf3n que incluye "closure" \u2192 "largeData".'}),"\n",(0,a.jsx)(n.h3,{id:"retenci\xf3n-de-elementos-dom-eliminados",children:"Retenci\xf3n de elementos DOM eliminados"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"let deletedNode;\r\n\r\nfunction detachNode() {\r\n  const node = document.createElement('div');\r\n  document.body.appendChild(node);\r\n  // Eliminamos del DOM pero mantenemos referencia\r\n  deletedNode = node;\r\n  document.body.removeChild(node);\r\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:'El elemento mostrar\xe1 "(detached)" pero seguir\xe1 en memoria con una ruta que incluye la variable global.'}),"\n",(0,a.jsx)(n.h3,{id:"retenci\xf3n-en-event-listeners",children:"Retenci\xf3n en event listeners"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function setupHandler() {\r\n  const data = new Array(1000000).fill('x');\r\n  document.getElementById('button').addEventListener('click', function() {\r\n    console.log(data.length);\r\n  });\r\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"La ruta mostrar\xe1 una cadena desde el nodo DOM hasta el listener y el objeto data."}),"\n",(0,a.jsx)(n.h2,{id:"an\xe1lisis-sistem\xe1tico-de-rutas-de-retenci\xf3n",children:"An\xe1lisis sistem\xe1tico de rutas de retenci\xf3n"}),"\n",(0,a.jsx)(n.p,{children:"Para identificar eficazmente la causa de una fuga:"}),"\n",(0,a.jsx)(n.h3,{id:"m\xe9todo-de-seguimiento-de-rutas",children:"M\xe9todo de seguimiento de rutas"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Identifica objetos sospechosos (grandes o numerosos)"}),"\n",(0,a.jsx)(n.li,{children:"Selecciona uno de estos objetos"}),"\n",(0,a.jsx)(n.li,{children:"Analiza su ruta de retenci\xf3n hasta la ra\xedz GC"}),"\n",(0,a.jsx)(n.li,{children:"Identifica el punto en la cadena donde no deber\xeda existir una referencia"}),"\n",(0,a.jsx)(n.li,{children:"Examina el c\xf3digo relacionado con ese punto"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"an\xe1lisis-de-dominadores",children:"An\xe1lisis de dominadores"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:'Cambia a la vista "Dominators"'}),"\n",(0,a.jsx)(n.li,{children:'Encuentra objetos con gran "retained size"'}),"\n",(0,a.jsx)(n.li,{children:"Analiza sus rutas de retenci\xf3n"}),"\n",(0,a.jsx)(n.li,{children:"Identifica los dominadores clave que retienen grandes bloques de memoria"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"casos-de-estudio-comunes",children:"Casos de estudio comunes"}),"\n",(0,a.jsx)(n.h3,{id:"detectar-event-listeners-persistentes",children:"Detectar event listeners persistentes"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:'Busca objetos de tipo "EventListener" o "Event"'}),"\n",(0,a.jsx)(n.li,{children:"Analiza sus rutas para identificar elementos que retienen eventos"}),"\n",(0,a.jsx)(n.li,{children:"Verifica si estos elementos ya no deber\xedan estar activos"}),"\n",(0,a.jsxs)(n.li,{children:["En el c\xf3digo, aseg\xfarate de usar ",(0,a.jsx)(n.code,{children:"removeEventListener"})," donde sea necesario"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"analizar-referencias-circulares",children:"Analizar referencias circulares"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Identifica objetos con referencias cruzadas"}),"\n",(0,a.jsx)(n.li,{children:"Las rutas de retenci\xf3n mostrar\xe1n patrones como A\u2192B\u2192C\u2192A"}),"\n",(0,a.jsx)(n.li,{children:"Busca el punto donde se puede romper el ciclo"}),"\n",(0,a.jsx)(n.li,{children:"Implementa t\xe9cnicas como WeakMap o referencias nulas para solucionar"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"identificar-caches-sin-l\xedmites",children:"Identificar caches sin l\xedmites"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Busca grandes colecciones (Arrays, Maps, Sets)"}),"\n",(0,a.jsx)(n.li,{children:"Analiza qu\xe9 objeto los retiene"}),"\n",(0,a.jsx)(n.li,{children:"Verifica si ese objeto implementa alg\xfan mecanismo de caducidad o l\xedmite"}),"\n",(0,a.jsx)(n.li,{children:"Implementa estrategias como LRU cache para evitar crecimiento ilimitado"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"consejos-avanzados",children:"Consejos avanzados"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Filtrado inteligente"}),': Utiliza b\xfasquedas como "detached" para encontrar nodos DOM desconectados']}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Anotaci\xf3n mental"}),": Mientras navegas por rutas complejas, toma notas de los puntos clave"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Uso de WeakMap/WeakSet"}),": Para referencias que no deber\xedan impedir la recolecci\xf3n de basura"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"An\xe1lisis de distancia"}),": Presta atenci\xf3n a objetos con distancias muy largas desde las ra\xedces GC"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Patrones de limpieza"}),": Implementa patrones como ",(0,a.jsx)(n.code,{children:"dispose()"})," en componentes para limpiar referencias"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"En la siguiente secci\xf3n, exploraremos la instrumentaci\xf3n de asignaci\xf3n para rastrear la creaci\xf3n de objetos en tiempo real."})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const a={},r=i.createContext(a);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);